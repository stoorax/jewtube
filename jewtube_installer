<#
JewTube Installer (inkl. yewtube)
Autor: Automatisch generiert basierend auf Nutzeranfrage
#>

# Logfile erstellen
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$logFile = "C:\Users\$env:USERNAME\AppData\Local\Temp\JewTube_Install_$timestamp.log"
Start-Transcript -Path $logFile -Append

Write-Host "**********************"
Write-Host "=== JewTube Installation ==="
Write-Host "Logfile: $logFile`n"

# 1. Python-Prüfung
$pythonPath = (Get-Command python -ErrorAction SilentlyContinue).Source
if (-not $pythonPath) {
    Write-Error "Python nicht gefunden! Bitte zuerst installieren: https://www.python.org/downloads/"
    exit 1
}
Write-Host "Python gefunden: $pythonPath`n"

# 2. Pip-Pakete installieren (inkl. yewtube)
$packages = @("yt-dlp", "ytmusicapi", "browser-cookie3", "yewtube")  # yewtube hinzugefügt

foreach ($pkg in $packages) {
    Write-Host "Installiere $pkg..."
    pip install --upgrade $pkg 2>&1 | Out-Host
    if ($LASTEXITCODE -ne 0) {
        Write-Warning "Fehler bei der Installation von $pkg!"
    }
}

# 3. Versionsprüfung
Write-Host "`n=== Versionsprüfung ==="
pip show yt-dlp ytmusicapi yewtube | Select-String "Version"  # yewtube hinzugefügt

# 4. Funktionstests
Write-Host "`n=== Funktionstest ==="

# Test yt-dlp
Write-Host "Teste yt-dlp (Rickroll)..."
yt-dlp -f b "https://www.youtube.com/watch?v=dQw4w9WgXcQ" --no-download

# Test yewtube
Write-Host "`nTeste yewtube..."
yewtube --version
if ($LASTEXITCODE -eq 0) {
    Write-Host "yewtube funktioniert! Starte mit: yewtube"
} else {
    Write-Warning "yewtube-Test fehlgeschlagen!"
}

# 5. Zusammenfassung
Write-Host "`n=== INSTALLATION ERFOLGREICH ==="
Write-Host "Installierte Tools:"
Write-Host "- yt-dlp (YouTube-Downloads)"
Write-Host "- ytmusicapi (YouTube Music API)"
Write-Host "- yewtube (Terminal-YouTube-Client)`n"

Write-Host "Logfile: $logFile"
Stop-Transcript

# Fertig
Read-Host "Drücken Sie ENTER zum Beenden..."
