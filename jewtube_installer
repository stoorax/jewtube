# jewtube_installer.ps1

Clear-Host
Write-Host "===============================" -ForegroundColor Cyan
Write-Host "  JEWTUBE ENVIRONMENT INSTALLER " -ForegroundColor Cyan
Write-Host "===============================" -ForegroundColor Cyan
Write-Host ""
Write-Host "This script will check and install all required components:" -ForegroundColor White
Write-Host " - Python 3.8+ (via py -3 launcher)"
Write-Host " - pip"
Write-Host " - yt-dlp"
Write-Host " - ytmusicapi"
Write-Host " - browser_cookie3" -ForegroundColor Yellow
Write-Host ""
Pause

function Wait-User() { Read-Host "Press [Enter] to continue..." }
function Write-Info($m)    { Write-Host $m -ForegroundColor White }
function Write-Success($m) { Write-Host "SUCCESS: $m" -ForegroundColor Green }
function Write-Warn($m)    { Write-Host "WARNING: $m" -ForegroundColor Red }

# Use Python launcher
$pythonExe = if (Get-Command py -ErrorAction SilentlyContinue) { "py -3" } else { "python" }

# 1) winget
Write-Info "1) Checking for winget..."
if (-not (Get-Command winget -ErrorAction SilentlyContinue)) {
    Write-Warn "winget not found! Cannot auto-install Python."
    Wait-User; exit 1
}
Write-Success "winget found."
Wait-User

# 2) Python
Write-Info "2) Checking for Python via launcher ($pythonExe)..."
try {
    $ver = & $pythonExe "--version" 2>&1
    Write-Success "Python found: $ver"
} catch {
    Write-Warn "Python not found! Installing via winget..."
    Wait-User
    winget install --id Python.Python.3 --silent --accept-source-agreements --accept-package-agreements
    Start-Sleep -Seconds 10
    try {
        $ver = & $pythonExe "--version" 2>&1
        Write-Success "Python installed: $ver"
    } catch {
        Write-Warn "Failed to install Python."
        Wait-User; exit 1
    }
}
Wait-User

# Reload PATH
$env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine")

# 3) pip
Write-Info "3) Checking for pip..."
try {
    $pipVer = & $pythonExe -m pip --version 2>&1
    Write-Success "pip found: $pipVer"
} catch {
    Write-Info "pip not found. Installing ensurepip..."
    & $pythonExe -m ensurepip --upgrade | Out-Null
    Write-Success "pip installed."
}
Wait-User

# 4) Upgrade pip
Write-Info "4) Upgrading pip..."
& $pythonExe -m pip install --upgrade pip
Write-Success "pip upgraded."
Wait-User

# 5) Install Python packages
$pkgs = @("yt-dlp","ytmusicapi","browser_cookie3")
Write-Info "5) Installing Python packages: $($pkgs -join ', ')..."
Wait-User
& $pythonExe -m pip install --upgrade $pkgs
Write-Success "Packages installed."
Wait-User

# 6) Verify modules
Write-Info "6) Verifying installations..."
$errors = 0
foreach ($m in @("ytmusicapi","browser_cookie3")) {
    & $pythonExe -c "import $m" 2>$null
    if ($LASTEXITCODE -eq 0) {
        Write-Success "$m OK"
    } else {
        Write-Warn "$m FAILED"
        $errors++
    }
    Wait-User
}

try {
    $v = & yt-dlp --version 2>&1
    Write-Success "yt-dlp OK: Version $v"
} catch {
    Write-Warn "yt-dlp FAILED"
    $errors++
}
Wait-User

# 7) Final
if ($errors -eq 0) {
    Write-Success "All components are installed and verified. Jewtube is ready!"
} else {
    Write-Warn "Some components failed. Please check above messages."
}
Wait-User

Write-Host "`n=== Installer completed ===" -ForegroundColor Cyan
Wait-User
